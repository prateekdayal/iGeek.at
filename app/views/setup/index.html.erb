<h1>What do you use?</h1>

<div id="content">
  <input id="products" size="50" />

  <div id="list">
    <% @already_using.each do |product|%>
      <%= render :partial => 'products/product', :locals => {:product => product}%>
    <%end-%>
  </div>
</div>

<div id="sidebar">
  <h3>Popular Products not in your list</h3>
  <% @popular.each do |product|%>
    <%= render :partial => 'products/product', :locals => {:product => product}%>
  <%end-%>
</div>

<script type="text/javascript">

  var renderProduct = function(product){
    return "<div class='block'><img src='" + product.icon.ninety.url + "'/></div>"
  };

  $("#products").bind( "keydown", function( event ) {
				if ( event.keyCode === $.ui.keyCode.TAB &&
						$( this ).data( "autocomplete" ).menu.active ) {
					event.preventDefault();
				}
			}).autocomplete({
				minLength: 0,
        source: <%=raw @autocomplete_array.to_json%>,
				focus: function() {
					// prevent value inserted on focus
					return false;
				},
				select: function( event, ui ) {
          term = ui.item;
          console.log(term.label);
          $.ajax('/users/<%=current_user.id%>/products?id=' + term.value, {
            type: 'post',
            success: function(data, status){
              console.log(data);
              script = $(data).text();
              eval(script);
          //    $("#list").prepend(renderProduct(data.product));
            }
          });
          this.value = '';
					return false;
				}
			});

</script>

